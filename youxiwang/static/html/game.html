<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>游戏王</title>
	<script src="js/jquery.min.js"></script>
	<script src="js/socket.io.js"></script>
	<style>
		* {
			margin: 0;
		}

		button {
			opacity: 0.8;
			background-color: #FF4500;
			border: 0px;
		}

		.headers {
			position: relative;
			width: 1346px;
			height: 637px;
			background: url("img/bg.jpg");
			padding: 10px;
		}

		/*左边框*/
		.left-border {
			width: 490px;
			position: absolute;
		}


		/*图片显示*/
		.card-view {
			width: 350px;
			height: 282px;
			margin-right: 10px;
			float: left;
		}

		/*投降*/
		.over {
			width: 130px;
			height: 70px;
			float: left;
		}

		/*左下框*/
		.left-bottom {
			height: 297px;
			margin-top: 10px;
			background-color: #DCDCDC;
		}



		/*右边框*/
		.right-border {
			position: absolute;
			border: 1px solid green;
			left: 500px;
			width: 812px;
		}

		/*右上边框*/
		.right-top {
			height: 70px;
			width: 820px;
			overflow: hidden;
		}

		/*左血条*/
		.left-blood {
			width: 338px;
			float: left;
			background-color: red;
		}

		/*回合*/
		.round {
			margin: 0px 34px;
			width: 68px;
			float: left;
			background-color: yellow;
		}

		/*右血条*/
		.right-blood {
			width: 338px;
			background-color: red;
			float: left;
		}

		/*右下边框*/
		.right-bottom {
			margin-top: 17px;
			height: 502px;
		}

		/* 左卡组 */
		.left-card {
			width: 68px;
			float: left;
		}

		/* 中间卡牌 */
		.center-card {
			width: 550px;
			float: left;
			margin: 0 63px;
		}

		/* 右卡组 */
		.right-card {
			width: 68px;
			float: left;
		}

		/*左边我方卡组*/
		.left-me-card {
			margin-top: 65px;
		}
		
		/*左边卡组图片属性设置*/
		.left-card img {
			width: 80%;
		}

		/*左边卡组图片属性设置*/
		.left-card {
		 	text-align: center;
		}

		/*右边我方卡组*/
		.right-me-card {
			margin-top: 70px;
		}
		
		/*右边卡组图片属性设置*/
		.right-card img {
			width: 80%;
		}

		/*右边卡组图片属性设置*/
		.right-card {
		 	text-align: center;
		}

		/*场地卡牌居中*/
		.center-card div {
			text-align: center;
		}

		/*场地卡片大小*/
		.area div div{
		 	display:inline-block;
			cursor:pointer;
			width: 102px;
		 	line-height:0;
			border: 1px solid #708090;
			vertical-align:middle;
		}
		.area div img {
			margin-top: 3px;
			width: 80%;
			height: 90%;
			vertical-align:bottom;
			position: relative;
		}

		/*敌方/我方手卡*/
		.you_hand a, .my_hand a {
		 	display:inline;
		}
		
		/*手牌不换行*/
		.my_hand, .you_hand {
			white-space:nowrap; 
			overflow: scroll;
		}

		
		/*css3去除滚动条*/
		::-webkit-scrollbar {
			width: 0px;
		}

		::-webkit-scrollbar-track {
			background-color: none;
		}

		::-webkit-scrollbar-thumb {
			background-color: none;
		}

		::-webkit-scrollbar-thumb:hover {
			background-color: none;
		}

		::-webkit-scrollbar-thumb:active {
			background-color: none;
		}
		
		
		/*敌方/我方卡牌大小*/
		.you_hand a img, .my_hand a img {
			width: 68px;
		}
		
		/*左视图图片大小*/
		.card-view img {
			width: 100%;
			height: 100%;
		}

		/*清除浮动*/
		.clear{ clear:both}

		/*给所有a标签添加手型*/
		a {
			cursor:pointer;
			text-decoration:none;
		}

		[v-cloak] {
		    display: none !important;
		}


	</style>

	<script>
		var a = 0; // 解决点结束抽牌两次的参数
		var username_list = []
		var username = "";
		$.get("/session", function (resp) {
			if (resp.errno == 0) {
				username = resp.username;
			} else {
				alert(resp.errmsg);
				location.href = "/login.html";
			}
		})

		var a = true; // 手牌判断参数
		var t = []; // 存放手卡的对象
		var i = 1; // 用来判断手卡
		var token = 0;
		 
		$(document).ready(function () {
			// 手卡点击上浮
			function card (t) {
				if (token == 1) {
					var is_card = t.attr('name');
					if (is_card == 'mofa' || is_card == 'xianjing') {
						if (a == true) {
							t.css("top", -10);
							t.find("button[name='fz']").fadeIn();
						} else {
							t.css("top", 0);
							t.find("button[name='fz']").hide();
						}
						a = !a;
					} else {
						if (a == true) {
							t.css("top", -10);
							t.find("button[name='zh']").fadeIn();
							t.find("button[name='fz']").fadeIn();
						} else {
							t.css("top", 0);
							t.find("button[name='zh']").hide();
							t.find("button[name='fz']").hide();
						}
						a = !a;
					}
				}
			}

			var card_dict = {
				"btm1": "top10",
				"btm2": "top9",
				"btm3": "top8",
				"btm4": "top7",
				"btm5": "top6",
				"btm6": "top5",
				"btm7": "top4",
				"btm8": "top3",
				"btm9": "top2",
				"btm10": "top1",
				"top10": "btm1",
				"top9": "btm2",
				"top8": "btm3",
				"top7": "btm4",
				"top6": "btm5",
				"top5": "btm6",
				"top4": "btm7",
				"top3": "btm8",
				"top2": "btm9",
				"top1": "btm10",
				"m1": "y5",
				"m2": "y4",
				"m3": "y3",
				"m4": "y2",
				"m5": "y1",
				"y1": "m5",
				"y2": "m4",
				"y3": "m3",
				"y4": "m2",
				"y5": "m1",
			}

			var url = "http://" + document.domain + ":" + location.port;
			var io_client = io.connect(url);
			io_client.on("connect", function () {
				// 连接成功事件
				io_client.emit("connect_send", username);
				console.log('连接成功');
				console.log("等待新客户端连接");
				showOverlay();
			});

			// 接受玩家2信息
			io_client.on("wait_join", function (resp) {
				io_client.emit("wait_join2", username);
				hideOverlay();
				var resp = JSON.parse(resp);
				username_list[0] = username;
				username_list[1] = resp.username;
				console.log(username_list);
				console.log("有客户端连接上了"+resp.username);
				io_client.emit("swap", username_list[1]);
				io_client.emit("send_init_token");
				setTimeout(function () { 
					flush_card_group(); // 刷新对方卡组
			    }, 500);
			})


			// 更新对面卡组等数目
			function flush_card_group () {
				console.log("更新对面卡组等数目");
				c_group = vue.left_r_card();
				io_client.emit("card_group", c_group, username);
			}

			// 更新对面卡组等数目(接收)
			io_client.on("c_group", function (resp) {
				var resp = JSON.parse(resp);
				$("#y-kazu").html(resp.c_group[0]);
				$("#y-chuwai").html(resp.c_group[1]);
				$("#y-rhkazu").html(resp.c_group[2]);
				$("#y-changjing").html(resp.c_group[3]);
				console.log(resp.c_group);
			})

			// 显示自己的回合
			io_client.on("show_hhz", function (resp) {
				var resp = JSON.parse(resp);
				user(resp.username);
			})

			// token改变值
			io_client.on("rec_token", function (resp) {
				console.log("进token");
				var resp = JSON.parse(resp);
				token = resp.token
				// 抽牌
				vue.ck();
				add_your_hand();
				setTimeout(function () { 
					flush_card_group(); // 刷新对方卡组
			    }, 500);
			})

			function user(user_name) {
				$("#huihe").html(user_name+"的回合");
				$("#huihe").show();
			}

			// 初始化token
			io_client.on("init_token", function (resp) {
				console.log("初始化token");
				var resp = JSON.parse(resp);
				token = resp.token;
				a = 1;
				add_your_hand();
				vue.ck(); // 抽牌
				setTimeout(function () { 
					flush_card_group(); // 刷新对方卡组
			    }, 500);
			})

			// 卡牌socket
			io_client.on("zh_success", function (resp) {
				console.log("召唤成功");
				var resp = JSON.parse(resp);
				var id = resp['id'];
				var img = resp['img'];
				var atk = resp['atk'];
				var defend = resp["defend"];
				id = card_dict[id];
				$("#"+id).attr("src", img);
			})

			// 攻击 socket
			io_client.on("gj_success", function (resp) {
				console.log("攻击成功");
				var resp = JSON.parse(resp);
				var id = resp['id'];
				var img = resp['img'];
				var atk = resp['atk'];
				var defend = resp["defend"];
				id = card_dict[id];
				$("#"+id).attr("src", img);
				$("#"+id).parent().find('span').hide();
			})

			// 卡牌(攻击力/防守力)socket
			io_client.on("ad_success", function (resp) {
				console.log("召唤成功");
				var resp = JSON.parse(resp);
				var id = resp['id'];
				var img = resp['img'];
				var atk = resp['atk'];
				var defend = resp["defend"];
				id = card_dict[id];
				$("#"+id).attr("src", img);
				s_html = atk +"/" + defend;
				$("#"+id).next('span').html(s_html);
				$("#"+id).next('span').show();
			})

			// 移除手牌
			function remove_your_hand(){
				io_client.emit("remove_your_hand", username);
			}

			io_client.on("rv_remove_your_hand", function () {
				$('.you_hand a')[0].remove();
			})

			// 添加手牌
			function add_your_hand(){
				io_client.emit("add_your_hand", username);
			}

			io_client.on("rv_add_your_hand", function () {
				if (a != 0) {
					html = '<a><img id="y1" style="height:47px" src="img/bm.jpg" alt=""></a>';
					$('.you_hand').append(html);
					a = 0;
				}
				
			})

			// 送去墓地
			io_client.on("rv_md_card", function (resp) {
				console.log("墓地");
				var resp = JSON.parse(resp);
				var md_num = resp.md_num;
				var md_img = resp.md_img;
				var id = resp.id;
				// 去除放置卡片送去墓地还遗留的css
				$("#"+card_dict[id]).css("transform", "rotate(0deg)");
				$("#"+card_dict[id]).css("width", "80%");
				$("#"+card_dict[id]).css("height", "90%");
				$("#"+card_dict[id]).css("top", "0px");
				$("#mudi").prev().attr("src", md_img);
				$("#mudi").html("("+md_num+")");

			})

			// 放置卡牌送去墓地保存的图片
			io_client.on('recv_src', function (resp) {
				console.log("墓地卡片");
				var resp = JSON.parse(resp); 
				$("#"+card_dict[resp.id]).attr("md_img", resp.src); 
			})

			// 回合结束 交换回合
			$('#jieshu').click(function () {
				console.log("结束");
				token = 0;
				a = 1; // 解决点结束抽牌两次的参数
				io_client.emit("token", username);
				io_client.emit("swap", username_list[1]);
				$(this).fadeOut();
			})


			//---------------------------------------------------------------------------------------
			// 点击手牌向上偏移
			$(".my_hand").on('click', 'a', function(){
				var card_id = $(this).attr('card_id');
				// 点击显示卡牌信息
				$.get("/fund_card", {card_id: card_id}, function (resp) {
					$(".card-view").find('img').attr('src', "image/"+resp.img);
					$(".left-bottom div").html(resp.name);
					var card_type = resp.card_type;
					var race = resp.race;
					var attr = resp.attribute;
					var str = ""
					if (race != "") {
						str = "["+ card_type +"]" + race +"/"+ attr;
					} else {
						str = "["+ card_type +"]";
					}
					if((resp.card_type).indexOf("怪兽") > -1) {
						var star = resp.level;
						var atk = resp.atk;
						var def = resp.defend;
						var s = "["+ star +"]" + atk + "/" + def;
						$("#view-atk").html(s);
					}
					$("#view-attr").html(str);
					$("#view-desc").html(resp.desc);
				})
				if(i == 1) {
					t.unshift($(this))
				}
				i++;
				var g = t.pop();
				t.unshift($(this));
				if (g.is($(this))) {	// 如果点击的牌是上一次点击的牌就执行
					card(g);	
				} else if (!g.is($(this)) && a == false) {	// 如果点击的牌不是上一次点击的牌并且a=false就执行
					card(g);
					card($(this));
				} else {	// 如果点击的牌不是上一次点击的牌并且a=true就执行
					card($(this));
				}
			});

			

			// 解绑怪兽区域
			function unbind_guaishou() {
				$("#me-guaishou div").css("border", "1px solid #708090");
				$("#me-guaishou div").css("cursor", "pointer");
				$("#me-guaishou div").unbind("click");
			}

			// 解绑放置区域
			function unbind_fangzhi() {
				$("#me-fangzhi div").css("border", "1px solid #708090");
				$("#me-fangzhi div").css("cursor", "pointer");
				$("#me-fangzhi div").unbind("click");
			}

			// 判断区域有没有存在卡牌，有卡牌的区域不加边框
			function is_card_area_border (id_img) {
				$(id_img).each(function () {
					var img_url = $(this).attr("src");
					if (img_url == "") {
						$(this).parent().css("border", "1px dashed #708090");
						$(this).parent().css("cursor", "Default");
					} 
				});
			}	
			
			var fz_id = "";
			var fz_img = "";
			var fz_atk = "";
			var fz_defend = "";

			// 判断区域有没有存在卡牌，有卡牌的区域不能选
			function is_card_area_no_choose (is_name) {
				// 魔法陷阱放置
				if (is_name == "fangzhi") {
					$("#me-fangzhi div").click(function () {
						if($(this).children('img').attr("src") == "") {
							// fz.next().attr('src', '');
							$(this).children('img').attr("md_img", src); // 魔法卡放置存储的图片
							$(this).children('img').attr("src", "img/bm.jpg");
							// 卡牌召唤socket
							id = $(this).children('img').attr('id');
							img = "img/bm.jpg";
							io_client.emit("card_luoji", id, img, username);
							remove_your_hand(); // 移除手卡
							unbind_fangzhi();
							fz.next().remove('img');
						}
					});
				} else if(is_name == "guaishou_zh") {	// 怪兽召唤
					$("#me-guaishou div").click(function () {
						if($(this).children('img').attr("src") == "") {
							var atk = gs.next().next().attr('atk'); // 获取攻击力
							var defend = gs.next().next().attr('defend'); // 获取防御力
							$(this).children('span').html(atk+"/"+defend);
							$(this).children('span').show()
							$(this).children('img').attr("src", src);
							$(this).children('img').attr("class", "img_zh");
							// 卡牌召唤socket
							id = $(this).children('img').attr('id');
							io_client.emit("send_src", id, src, username); // 放置卡牌送去墓地保存的图片
							io_client.emit("zh_card_luoji", id, src, atk, defend, username);
							remove_your_hand(); // 移除手卡
							unbind_guaishou();
							gs.next().next().remove('img');
						}
					});
				} else {	// 怪兽放置
					$("#me-guaishou div").click(function () {
						if($(this).children('img').attr("src") == "") {
							fz_atk = gs.next().next().attr('atk'); // 获取攻击力
							fz_defend = gs.next().next().attr('defend'); // 获取防御力
							$(this).children('span').html(fz_atk+"/"+fz_defend);
							$(this).children('img').attr("src", "img/bm.jpg");
							$(this).children('img').css("transform", "rotate(90deg)");
							$(this).children('img').css("width", "60%");
							$(this).children('img').css("height", "90px");
							$(this).children('img').css("top", "-13px");
							$(this).children('img').attr("class", "img_fz");
							$(this).children('img').attr("md_img", src); // 被攻击送去墓地存储的图片
							// 卡牌召唤socket
							fz_id = $(this).children('img').attr('id');
							io_client.emit("send_src", fz_id, src, username); // 放置卡牌送去墓地保存的图片
							fz_img = "img/bm.jpg";
							io_client.emit("card_luoji", fz_id, fz_img, username);
							remove_your_hand(); // 移除手卡
							unbind_guaishou();
							gs.next().next().remove('img');
						}
					});
				}
			}


			var src = ""; // 存储图片路径
			var gs = ""; // 存储zh对象
			var fz = ""; // 存储fz对象

			// 我方召唤
			$(".my_hand").on("click", '.zh', function () {
				unbind_fangzhi();
				gs = $(this);
				src = $(this).next().next().attr('src');
				// 判断区域有没有存在卡牌，有卡牌的区域不加边框
				id_img = "#me-guaishou div img";
				is_card_area_border(id_img);
				// 判断区域有没有存在卡牌，有卡牌的区域不能选
				is_card_area_no_choose("guaishou_zh");
			});

			// 我方放置
			$(".my_hand").on("click", ".fz", function () {
				unbind_guaishou();
				fz = $(this);
				gs = $(this).prev();
				src = $(this).next().attr('src');
				var is_card = $(this).parents('a').attr('name');
				if (is_card == "mofa" || is_card == "xianjing") {
					// 判断区域有没有存在卡牌，有卡牌的区域不加边框
					id_img = "#me-fangzhi div img";
					is_card_area_border(id_img);
					// 判断区域有没有存在卡牌，有卡牌的区域不能选
					is_card_area_no_choose("fangzhi");
				} else {
					unbind_fangzhi();
					// 判断区域有没有存在卡牌，有卡牌的区域不加边框
					id_img = "#me-guaishou div img";
					is_card_area_border(id_img);
					// 判断区域有没有存在卡牌，有卡牌的区域不能选
					is_card_area_no_choose("guaishou_fz");
				}
			});


			// 判断对方区域有没有存在卡牌，没卡牌的区域不加边框
			function is_card_opponent_area_border (id_img) {
				$(id_img).each(function () {
					var img_url = $(this).attr("src");
					if (img_url != "") {
						$(this).parent().css("border", "1px dashed #708090");
						$(this).parent().css("cursor", "Default");
						$(this).attr('class', 'attacked');
					} 
				});
			}

			var md_num = 0; // 墓地计数

			// 敌方场地被攻击消除怪兽卡
			$('.you-guaishou div img').click(function () {
				if ($(this).attr('class') == 'attacked') {
					// 墓地卡片 -- start --
					var md_img = $(this).attr("md_img");
					console.log(md_img);
					md_num++;
					$("#y-mudi").prev().attr("src", md_img);
					$("#y-mudi").html("("+md_num+")");
					//  墓地卡片 -- end --
					$(this).attr('src', '');
					$(this).nextAll("span").hide();
					$(".you-guaishou div").css("border", "1px solid #708090");
					$(".you-guaishou div").css("cursor", "pointer");	
					$(".you-guaishou div img").attr("class", "");
					// 卡牌攻击socket
					var id = $(this).attr('id');
					var img = '';
					io_client.emit("gj_card_luoji", id, img, username);
					io_client.emit("md_card", id, md_num, md_img, username)
				}
			});

			
			// 怪兽反转/攻击
			$("#me-guaishou div img").click(function () {

				// 反转
					if($(this).attr("class") == "img_fz") {
						var btn = $(this).nextAll(".fanzhuan");
						$("#me-guaishou").children().find("button").hide(); // 不是当前点击的场地怪兽卡牌隐藏攻击
						$("#me-fangzhi").children().find("button").hide(); // 不是当前点击的魔法怪兽卡牌隐藏攻击
						if (token == 1) {
							btn.fadeIn();
							btn.click(function () {
								img = $(this).prev("img").attr("md_img");
								io_client.emit("zh_card_luoji", fz_id, fz_img, fz_atk, fz_defend, username);
								$(this).nextAll('span').show();
								$(this).prev("img").attr('src', img);
								$(this).prev("img").css("transform", "rotate(0deg)");
								$(this).prev('img').css("width", "80%");
								$(this).prev('img').css("height", "90%");
								$(this).prev('img').css("top", "0px");
								$(this).prev("img").attr('class', "img_zh");
								// 卡牌反转socket
								id = $(this).prev("img").attr('id');
								io_client.emit("card_luoji", id, img, username);
								$(this).fadeOut();
							})
						}
						
					}
					// 攻击
					if($(this).attr("class") == "img_zh") {
						var btn = $(this).nextAll('.gongji');
						$("#me-guaishou").children().find("button").hide(); // 不是当前点击的场地怪兽卡牌隐藏攻击
						$("#me-fangzhi").children().find("button").hide(); // 不是当前点击的魔法怪兽卡牌隐藏攻击
						if (token == 1) {
							btn.fadeIn();
							btn.click(function () {
								// 判断对方区域有没有存在卡牌，没卡牌的区域不加边框
								is_card_opponent_area_border('.you-guaishou div img');
								$(this).fadeOut();
							})
						}
					}

			});

			
				// 魔法卡反转发动
			$("#me-fangzhi div img").click(function () {
				var btn = $(this).next('button');
				$("#me-guaishou").children().find("button").hide(); // 不是当前点击的场地怪兽卡牌隐藏攻击
				$("#me-fangzhi").children().find("button").hide(); // 不是当前点击的魔法怪兽卡牌隐藏攻击
				if (token == 1) {
					btn.fadeIn();
					btn.click(function () {
						img = $(this).prev('img').attr("md_img");
						$(this).prev("img").attr('src', img);
						$(this).prev("img").css("transform", "rotate(0deg)");
						$(this).prev('img').css("width", "80%");
						$(this).prev('img').css("height", "90%");
						$(this).prev('img').css("top", "0px");
						// 卡牌反转socket
						id = $(this).prev("img").attr('id');
						io_client.emit("card_luoji", id, img, username);
						$(this).fadeOut();
					});
				}
			})
			
			
		})
	</script>
	<style>
		/* 半透明的遮罩层 */
		#overlay {
		  background: #000;
		  filter: alpha(opacity=50); /* IE的透明度 */
		  opacity: 0.5; /* 透明度 */
		  display: none;
		  position: absolute;
		  top: 0px;
		  left: 0px;
		  width: 100%;
		  height: 100%;
		  z-index: 100; /* 此处的图层要大于页面 */
		  display:none;
		}
	</style>
	<script>
		/* 显示遮罩层 */
		function showOverlay() {
		  $("#overlay").height(document.body.scrollHeight);
		  $("#overlay").width(document.body.scrollWidth);
		  // fadeTo第一个参数为速度，第二个为透明度
		  // 多重方式控制透明度，保证兼容性，但也带来修改麻烦的问题
		  $("#overlay").fadeTo(200, 0.5);
		  // 解决窗口缩小时放大后不全屏遮罩的问题
		  // 简单来说，就是窗口重置的问题
		  $(window).resize(function(){
		    $("#overlay").height(document.body.scrollHeight);
		    $("#overlay").width(document.body.scrollWidth);
		  });
		}
		/* 隐藏覆盖层 */
		function hideOverlay() {
		  $("#overlay").fadeOut(200);
		}
	</script>
</head>
<body>
	<div id="overlay" style="text-align: center; line-height: 500px; font-size: 60px; color: red;">等待客户端连接</div>
	<div id="huihe" style="width: 200px; height: 200px; font-size: 30px; color: red; text-align: center; line-height: 500px; z-index: 900; position: absolute; top: -180px; left: 50%;" hidden="hidden"></div>
	<div id="app" class="headers" v-cloak>
		<div class="left-border">
			<div class="left-top">
				<div class="card-view"><img style="" src="" alt=""></div>
				<div class="over"><input type="button" style="width:100%; height:100px" value="投降"></div>
				<div class="clear"></div> 
			</div>
			<div class="left-bottom">
				<div style="text-align:center;"></div><br>
				<span id="view-attr" style="color: blue"></span><br>
				<span id="view-atk" style="color: blue"></span><br>
				<span id="view-desc"></span>
			</div>
		</div>

		<div class="right-border">
			<div class="right-top">
				<div class="left-blood">4000</div>
				<div class="round">回合</div>
				<div class="right-blood">4000</div>
			</div>
			<div class="right-bottom">
				<div class="left-card">
					<div calss="left-you-card">
						<div style="position: relative;">
							<a><img style="height:47px" src="img/bm.jpg" alt="">
							<span id="y-kazu" style="color: red; position: absolute; left: 20px; bottom: 10px">(0)</span></a>
						</div>
						<div style="position: relative;">
							<a><img style="height:55px" src="img/bm.jpg" alt="">
							<span id="y-mudi" style="color: red; position: absolute; left: 20px; bottom: 10px">(0)</span></a>
						</div>
						<div style="position: relative;">
							<a><img style="height:60px" src="img/bm.jpg" alt="">
							<span id="y-chuwai" style="color: red; position: absolute; left: 20px; bottom: 10px">(0)</span></a>
						</div>
					</div>
					<div class="left-me-card">
						<div>
							<div style="position: relative;">
								<a>
									<img style="height:70px" src="img/bm.jpg" alt="">
									<span id="changjing" style="color: red; position: absolute; left: 20px; bottom: 10px">(0)</span>
								</a>
							</div>
							<div style="position: relative;">
								<a>
									<img style="height:75px" src="img/bm.jpg" alt="">
									<span id="rhkazu" style="color: red; position: absolute; left: 20px; bottom: 10px">({{fuse_len}})</span>
								</a>
							</div>
						</div>
					</div>
				</div>
				<div class="center-card">
					<div class="you_hand_card">
						<div class="you_hand">
							<a><img id="y1" style="height:47px" src="img/bm.jpg" alt=""></a>
							<a><img id="y2" style="height:47px" src="img/bm.jpg" alt=""></a>
							<a><img id="y3" style="height:47px" src="img/bm.jpg" alt=""></a>
							<a><img id="y4" style="height:47px" src="img/bm.jpg" alt=""></a>
							<a><img id="y5" style="height:47px" src="img/bm.jpg" alt=""></a>
						</div>
					</div>
					<div class="area">
						<div>
							<div style="height:55px"><img id="top1" src="" alt=""></div>
							<div style="height:55px"><img id="top2" src="" alt=""></div>
							<div style="height:55px"><img id="top3" src="" alt=""></div>
							<div style="height:55px"><img id="top4" src="" alt=""></div>
							<div style="height:55px"><img id="top5" src="" alt=""></div>
						</div>
						<div class="you-guaishou">
							<div style="height:60px"><img id="top6" src="" alt="">
								<span style="font-size: 10px; color: white;position:relative; top: -10px;" hidden="hidden"><span>
							</div>
							<div style="height:60px"><img id="top7" src="" alt="">
								<span style="font-size: 10px; color: white;position:relative; top: -10px;" hidden="hidden"><span>
							</div>
							<div style="height:60px"><img id="top8" src="" alt="">
								<span style="font-size: 10px; color: white;position:relative; top: -10px;" hidden="hidden"><span>
							</div>
							<div style="height:60px"><img id="top9" src="" alt="">
								<span style="font-size: 10px; color: white;position:relative; top: -10px;" hidden="hidden"><span>
							</div>
							<div style="height:60px"><img id="top10" src="" alt="">
								<span style="font-size: 10px; color: white;position:relative; top: -10px;" hidden="hidden"><span>
							</div>
						</div>
						<div>
							<div style="height:65px"><img id="cen1" src="" alt=""></div>
							<div style="height:65px"><img id="cen2" src="" alt=""></div>
							<div style="height:65px"><img id="cen3" src="" alt=""></div>
							<div style="height:65px"><img id="cen4" src="" alt=""></div>
							<div style="height:65px">
								<button id="jieshu" style="position: relative; top: 20px">结束</button>
							</div>
						</div>
						<div id="me-guaishou">
							<div style="height:70px; position:relative">
								<img id="btm1" src="" alt="">
								<button class="fanzhuan" name="fanzhuan" style="position: absolute; top: 20px; left: 25px; width:50px;" hidden="hidden">反转</button>
								<button class="gongji" name="gongji" style="position: absolute; top: 20px; left: 25px; width:50px;" hidden="hidden">攻击</button>
								<span style="font-size: 10px; color: white;position:relative; top: -10px;" hidden="hidden"><span>
							</div>
							<div style="height:70px; position:relative">
								<img id="btm2" src="" alt="">
								<button class="fanzhuan" name="fanzhuan" style="position: absolute; top: 20px; left: 25px; width:50px;" hidden="hidden">反转</button>
								<button class="gongji" name="gongji" style="position: absolute; top: 20px; left: 25px; width:50px;" hidden="hidden">攻击</button>
								<span style="font-size: 10px; color: white;position:relative; top: -10px;" hidden="hidden"><span>
							</div>
							<div style="height:70px; position:relative">
								<img id="btm3" src="" alt="">
								<button class="fanzhuan" name="fanzhuan" style="position: absolute; top: 20px; left: 25px; width:50px;" hidden="hidden">反转</button>
								<button class="gongji" name="gongji" style="position: absolute; top: 20px; left: 25px; width:50px;" hidden="hidden">攻击</button>
								<span style="font-size: 10px; color: white;position:relative; top: -10px;" hidden="hidden"><span>
							</div>
							<div style="height:70px; position:relative">
								<img id="btm4" src="" alt="">
								<button class="fanzhuan" name="fanzhuan" style="position: absolute; top: 20px; left: 25px; width:50px;" hidden="hidden">反转</button>
								<button class="gongji" name="gongji" style="position: absolute; top: 20px; left: 25px; width:50px;" hidden="hidden">攻击</button>
								<span style="font-size: 10px; color: white;position:relative; top: -10px;" hidden="hidden"><span>
							</div>
							<div style="height:70px; position:relative">
								<img id="btm5" src="" alt="">
								<button class="fanzhuan" name="fanzhuan" style="position: absolute; top: 20px; left: 25px; width:50px;" hidden="hidden">反转</button>
								<button class="gongji" name="gongji" style="position: absolute; top: 20px; left: 25px; width:50px;" hidden="hidden">攻击</button>
								<span style="font-size: 10px; color: white;position:relative; top: -10px;" hidden="hidden"><span>
							</div>
						</div>
						<div id="me-fangzhi">
							<div style="height:75px; position:relative;">
								<img id="btm6" src="" alt="">
								<button class="fadong" name="fadong" style="position: absolute; top: 20px; left: 25px; width:50px;" hidden="hidden">发动</button>
							</div>
							<div style="height:75px; position:relative">
								<img id="btm7" src="" alt="">
								<button class="fadong" name="fadong" style="position: absolute; top: 20px; left: 25px; width:50px;" hidden="hidden">发动</button>
							</div>
							<div style="height:75px; position:relative">
								<img id="btm8" src="" alt="">
								<button class="fadong" name="fadong" style="position: absolute; top: 20px; left: 25px; width:50px;" hidden="hidden">发动</button>
							</div>
							<div style="height:75px; position:relative">
								<img id="btm9" src="" alt="">
								<button class="fadong" name="fadong" style="position: absolute; top: 20px; left: 25px; width:50px;" hidden="hidden">发动</button>
							</div>
							<div style="height:75px; position:relative">
								<img id="btm10" src="" alt="">
								<button class="fadong" name="fadong" style="position: absolute; top: 20px; left: 25px; width:50px;" hidden="hidden">发动</button>
							</div>
						</div>
					</div>
					<div class="my_hand_card">
						<div class="my_hand" style="width:547px;">
							<!-- <a name="guaishou" style="position:relative;">
								<button class="zh" name="zh" style="position: absolute; top: -50px; left: 10px; width:50px;" hidden="hidden">召唤</button>
								<button class="fz" name="fz" style="position: absolute; top: -20px; left: 10px; width:50px;" hidden="hidden">放置</button>
								<img id="m1" style="height:80px" src="img/1190.jpg" alt="">
							</a> -->
							
						</div>
					</div>
				</div>
				<div class="right-card">
					<div calss="right-you-card">
						<div style="position: relative;">
							<a><img style="height:47px" src="img/bm.jpg" alt=""></a>
							<span id="y-changjing" style="color: red; position: absolute; left: 20px; bottom: 10px">(0)</span></a>
						</div>
						<div style="position: relative;">
							<a><img style="height:55px" src="img/bm.jpg" alt=""></a>
							<span id="y-rhkazu" style="color: red; position: absolute; left: 20px; bottom: 10px">(0)</span></a>
						</div>
					</div>
					<div class="right-me-card">
						<div>
							<div style="position: relative;">
								<a>
									<img style="height:65px" src="img/bm.jpg" alt="">
									<span id="chuwai" style="color: red; position: absolute; left: 20px; bottom: 10px">(0)</span>
								</a>
							</div>
							<div style="position: relative;">
								<a>
									<img style="height:70px" src="img/bm.jpg" alt="">
									<span id="mudi" style="color: red; position: absolute; left: 20px; bottom: 10px">(0)</span>
								</a>
							</div>
							<div style="position: relative;">
								<a>
									<img style="height:75px" src="img/bm.jpg" alt="">
								</a>
								<span id="kazu" style="color: red; position: absolute; left: 20px; bottom: 30px">({{card_len}})</span>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	
	<script src="js/axios.min.js"></script>
	<script src="js/vue.js"></script>
	

	<script>

		var vue = new Vue({
			el: '#app',
			data () {
			    return {
			      card_len: 0,	// 牌组长度
			      card_lis: [], // 牌组
			      fuse_len: 0, // 融合卡组长度
			      fuse_lis: [], // 融合卡
			      firstname:0,
			    }
			},

			methods: {
				left_r_card: function() {
					kazu = $("#kazu").html();
					chuwai = $("#chuwai").html();
					rhkazu = $("#rhkazu").html();
					changjing = $("#changjing").html();
					return [kazu, chuwai, rhkazu, changjing]					
				},

				ck: function () {
					card = vue.card_lis.pop()
					vue.card_len = vue.card_lis.length;
					var html = "";
					if (card.atk == null) { card.atk = 0 }
					if (card.defend == null) { card.defend = 0 }
					if (card.card_type.indexOf("魔法") > -1 || card.card_type.indexOf("陷阱") > -1) {
						// 说明是魔法卡|陷阱卡
						html = '<a name="mofa" style="position:relative;" card_id="'+card.id+'">\
						<button class="zh" name="zh" style="position: absolute; top: -50px; left: 10px; width:50px;" hidden="hidden">召唤</button>\
						<button class="fz"  name="fz" style="position: absolute; top: -20px; left: 10px; width:50px;" hidden="hidden">放置</button>\
						<img style="height:80px" src="image/'+card.img+'">\
						</a>';
					} else {
						html = '<a name="guaishou" style="position:relative;" card_id="'+card.id+'">\
						<button class="zh" name="zh" style="position: absolute; top: -50px; left: 10px; width:50px;" hidden="hidden">召唤</button>\
						<button class="fz"  name="fz" style="position: absolute; top: -20px; left: 10px; width:50px;" hidden="hidden">放置</button>\
						<img style="height:80px" src="image/'+card.img+'" atk="'+card.atk+'" defend="'+card.defend+'">\
						</a>';
					}
					
					$(".my_hand").append(html);
				},

				get_hand: function () {
					console.log("进来了")
					for (var i=1; i <= 5; i++) {
						card = vue.card_lis.pop();
						vue.card_len = vue.card_lis.length;
						var html = "";
						if (card.atk == null) { card.atk = 0 }
						if (card.defend == null) { card.defend = 0 }
						if (card.card_type.indexOf("魔法") > -1 || card.card_type.indexOf("陷阱") > -1) {
							// 说明是魔法卡|陷阱卡
							html = '<a name="mofa" style="position:relative;" card_id="'+card.id+'">\
							<button class="zh" name="zh" style="position: absolute; top: -50px; left: 10px; width:50px;" hidden="hidden">召唤</button>\
							<button class="fz"  name="fz" style="position: absolute; top: -20px; left: 10px; width:50px;" hidden="hidden">放置</button>\
							<img id="m1" style="height:80px" src="image/'+card.img+'">\
							</a>';
						} else {
							html = '<a name="guaishou" style="position:relative;" card_id="'+card.id+'">\
							<button class="zh" name="zh" style="position: absolute; top: -50px; left: 10px; width:50px;" hidden="hidden">召唤</button>\
							<button class="fz"  name="fz" style="position: absolute; top: -20px; left: 10px; width:50px;" hidden="hidden">放置</button>\
							<img id="m'+i+'" style="height:80px" src="image/'+card.img+'" atk="'+card.atk+'" defend="'+card.defend+'">\
							</a>';
						}
						
						$(".my_hand").append(html);
					}
				},
				

			},

			created () {
				$.get("/check_bag", function (resp) {
					console.log(resp);
					vue.card_len = resp.card.length;
					vue.card_lis = resp.card;
					vue.fuse_len = resp.fuse.length;
					vue.fuse_lis = resp.fuse;
					vue.firstname = 2;
					console.log(vue.card_lis);
				});
			},

			watch: {
				'firstname': function(newVal){
					this.get_hand();
				},
			 } 

		});

	</script>

</body>
</html>